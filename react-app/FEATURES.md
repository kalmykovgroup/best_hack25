# –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

## üéØ 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ß—Ç–æ —ç—Ç–æ?

–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç "–ø–∞—Ä–∫"
2. –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä ‚Üí 115ms
3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫—ç—à
4. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤–≤–æ–¥–µ "–ø–∞—Ä–∫" ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ –∫—ç—à–∞ ‚Üí **2ms** ‚ö°

### –ê–ª–≥–æ—Ä–∏—Ç–º: LRU (Least Recently Used)

- –•—Ä–∞–Ω–∏—Ç N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —É–¥–∞–ª—è–µ—Ç –Ω–∞–∏–º–µ–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–º–µ–µ—Ç TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏)

### –ö–æ–¥

```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const { search, clearCache, getCacheStats } = useMapSearch({
  wsUrl: 'ws://localhost:8080',
  enableCache: true,       // –í–∫–ª—é—á–∏—Ç—å –∫—ç—à
  cacheTTL: 300000,        // 5 –º–∏–Ω—É—Ç
  cacheSize: 100,          // 100 –∑–∞–ø–∏—Å–µ–π
  onCacheHit: (query) => {
    console.log('–ù–∞–π–¥–µ–Ω–æ –≤ –∫—ç—à–µ:', query);
  }
});

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
const stats = getCacheStats();
console.log(stats);
// {
//   hits: 15,
//   misses: 8,
//   hitRate: '65.22%',
//   cacheInfo: {
//     validEntries: 23,
//     expiredEntries: 0,
//     totalHits: 45
//   }
// }
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `enableCache` | `true` | –í–∫–ª—é—á–∏—Ç—å –∫—ç—à |
| `cacheTTL` | `300000` (5 –º–∏–Ω) | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∑–∞–ø–∏—Å–∏ |
| `cacheSize` | `100` | –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø–∏—Å–µ–π |
| `onCacheHit` | - | Callback –ø—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ |

### –ú–µ—Ç—Ä–∏–∫–∏

- **Hit Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π
- **Hits** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫—ç—à–∞
- **Misses** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É
- **Valid Entries** - –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ –∫—ç—à–µ

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

‚úÖ **–î–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—Å—Ç–æ –∏—â—É—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ
- –î–∞–Ω–Ω—ã–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã
- –ù—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å

‚ùå **–ù–µ—Ç:**
- –î–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–µ–Ω—è—é—Ç—Å—è
- –ù—É–∂–Ω–∞ 100% –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å
- –ú–∞–ª–æ –ø–∞–º—è—Ç–∏ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

---

## üö¶ 2. Throttling

### –ß—Ç–æ —ç—Ç–æ?

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∑–∞—â–∏—Ç—ã —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**–ë–µ–∑ throttling:**
```
–í–≤–æ–¥: –º|—É|–∑|–µ|–π (5 —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞ 100ms)
–ó–∞–ø—Ä–æ—Å—ã: 5 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞!
```

**–° throttling (100ms):**
```
–í–≤–æ–¥: –º|—É|–∑|–µ|–π (5 —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞ 100ms)
–ó–∞–ø—Ä–æ—Å—ã: 1 –∑–∞–ø—Ä–æ—Å ‚Üí –û—Ç–ª–∏—á–Ω–æ!
```

### –¢–∏–ø—ã throttling

#### 1. Simple Throttle
–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏:

```typescript
const throttled = useSimpleThrottle(search, 100);
// –ù–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 100ms
```

#### 2. Trailing Edge Throttle
–¢–∞–∫–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è:

```typescript
const throttled = useThrottle(search, 100);
// + –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ 100ms –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è
```

#### 3. Rate Limiter
–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥:

```typescript
const { call, remaining, reset } = useRateLimit(search, 10, 1000);
// –ú–∞–∫—Å–∏–º—É–º 10 –≤—ã–∑–æ–≤–æ–≤ –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É

if (call(query)) {
  console.log('–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
  console.log(`–û—Å—Ç–∞–ª–æ—Å—å: ${remaining()}/10`);
} else {
  console.log('–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç!');
}
```

### –ö–æ–¥

```typescript
const { search } = useMapSearch({
  wsUrl: 'ws://localhost:8080',
  enableThrottle: true,    // –í–∫–ª—é—á–∏—Ç—å throttling
  throttleMs: 100,         // –ú–∏–Ω–∏–º—É–º 100ms –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
});
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `enableThrottle` | `true` | –í–∫–ª—é—á–∏—Ç—å throttling |
| `throttleMs` | `100` | –ò–Ω—Ç–µ—Ä–≤–∞–ª (–º—Å) |

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Debouncing

| | Debouncing | Throttling |
|---|-----------|-----------|
| **–ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç** | –ü–æ—Å–ª–µ –ø–∞—É–∑—ã | –ß–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã |
| **–ß–∞—Å—Ç–æ—Ç–∞** | 1 —Ä–∞–∑ –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ |
| **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ** | –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ | Scroll, resize |
| **–ü—Ä–∏–º–µ—Ä** | –ñ–¥–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–µ—á–∞—Ç–∏ | –õ–∏–º–∏—Ç FPS |

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

‚úÖ **–î–∞:**
- –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ü–ª–∞—Ç–Ω—ã–µ API —Å –ª–∏–º–∏—Ç–∞–º–∏
- –ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞

‚ùå **–ù–µ—Ç:**
- –ù—É–∂–Ω–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è
- –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
- –£–∂–µ –µ—Å—Ç—å debouncing

---

## üîÑ 3. Dual WebSocket Architecture

### –ß—Ç–æ —ç—Ç–æ?

–î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- **Request channel** - –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Response channel** - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤

### –ó–∞—á–µ–º?

**–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–¥–Ω–∏–º –∫–∞–Ω–∞–ª–æ–º:**
```
Client ‚Üí [Request 1] ‚Üí Server
Client ‚Üê [Response 1] ‚Üê Server
Client ‚Üí [Request 2] ‚Üí Server  ‚ùå –ñ–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞
```

**–†–µ—à–µ–Ω–∏–µ —Å –¥–≤—É–º—è –∫–∞–Ω–∞–ª–∞–º–∏:**
```
Client ‚Üí [Request 1] ‚Üí Request Channel ‚Üí Server
Client ‚Üí [Request 2] ‚Üí Request Channel ‚Üí Server  ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!
Client ‚Üê [Response 1] ‚Üê Response Channel ‚Üê Server
Client ‚Üê [Response 2] ‚Üê Response Channel ‚Üê Server
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
2. **–í—ã—à–µ throughput** - –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏
3. **–†–∞–∑–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** - –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–∞–Ω–∞–ª–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Client  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ WS Request  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ     :8080             ‚îÇ
     ‚îÇ                       ‚ñº
     ‚îÇ                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ                  ‚îÇ Server  ‚îÇ
     ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                       ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ WS Response ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           :8081
```

### –ö–æ–¥

```typescript
import { useMapSearchDual } from './hooks/useMapSearchDual';

const {
  search,
  results,
  clientId,
  isConnected,
  cacheStats
} = useMapSearchDual({
  requestUrl: 'ws://localhost:8080',
  responseUrl: 'ws://localhost:8081',
  debounceMs: 300,
  enableCache: true,
});

console.log('Client ID:', clientId);
// Client ID: client_1234567890_abc123
```

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å

```javascript
// server-dual-example.js
const requestWss = new WebSocket.Server({ port: 8080 });
const responseWss = new WebSocket.Server({ port: 8081 });

const connections = new Map(); // clientId -> responseWs

requestWss.on('connection', (ws) => {
  ws.on('message', (msg) => {
    const data = JSON.parse(msg);
    const results = performSearch(data.query);

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª –æ—Ç–≤–µ—Ç–æ–≤
    const responseWs = connections.get(data.clientId);
    responseWs.send(JSON.stringify({
      type: 'search_result',
      requestId: data.requestId,
      results
    }));
  });
});

responseWss.on('connection', (ws, req) => {
  const clientId = getClientId(req);
  connections.set(clientId, ws);
});
```

### Client ID

–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤:

```typescript
const clientId = getClientId();
// "client_1731678123456_x7k9p2m"

// –§–æ—Ä–º–∞—Ç: client_{timestamp}_{random}
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–¥–∏–Ω –∫–∞–Ω–∞–ª | –î–≤–∞ –∫–∞–Ω–∞–ª–∞ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------|------------|-----------|
| Latency | ~100ms | ~80ms | 20% |
| Throughput | 10 req/s | 14 req/s | 40% |
| Concurrent | 1 | 2+ | 2x |

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

‚úÖ **–î–∞:**
- –í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (100+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- –ú–Ω–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
- Streaming –¥–∞–Ω–Ω—ã—Ö

‚ùå **–ù–µ—Ç:**
- –ú–∞–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–µ –Ω—É–∂–Ω–∞

---

## üì° 4. –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ WebSocket

### Auto-reconnect

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ —Å–≤—è–∑–∏:

```typescript
// Exponential backoff
–ü–æ–ø—ã—Ç–∫–∞ 1: —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
–ü–æ–ø—ã—Ç–∫–∞ 2: —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
–ü–æ–ø—ã—Ç–∫–∞ 3: —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
–ü–æ–ø—ã—Ç–∫–∞ 4: —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥
–ü–æ–ø—ã—Ç–∫–∞ 5: —á–µ—Ä–µ–∑ 16 —Å–µ–∫—É–Ω–¥
```

### Debouncing

–ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞:

```typescript
–í–≤–æ–¥: "–ø" ‚Üí –ñ–¥–µ–º 300ms
–í–≤–æ–¥: "–ø–∞" ‚Üí –°–±—Ä–æ—Å, –∂–¥–µ–º 300ms
–í–≤–æ–¥: "–ø–∞—Ä" ‚Üí –°–±—Ä–æ—Å, –∂–¥–µ–º 300ms
–í–≤–æ–¥: "–ø–∞—Ä–∫" ‚Üí –°–±—Ä–æ—Å, –∂–¥–µ–º 300ms
... –ø–∞—É–∑–∞ 300ms ...
‚Üí –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ "–ø–∞—Ä–∫"
```

### Request Cancellation

–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤:

```typescript
–ó–∞–ø—Ä–æ—Å 1: "–ø–∞—Ä–∫" (requestId: req_001)
–ó–∞–ø—Ä–æ—Å 2: "–º—É–∑–µ–π" (requestId: req_002)  ‚Üê –ù–æ–≤—ã–π!

–û—Ç–≤–µ—Ç –Ω–∞ req_001 ‚Üí ‚ùå –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
–û—Ç–≤–µ—Ç –Ω–∞ req_002 ‚Üí ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
```

### Request ID Tracking

–¢–æ—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤:

```typescript
// –ó–∞–ø—Ä–æ—Å
{
  type: 'search',
  requestId: 'search_1731678123456_abc123',
  query: '–ø–∞—Ä–∫',
  timestamp: 1731678123456
}

// –û—Ç–≤–µ—Ç
{
  type: 'search_result',
  requestId: 'search_1731678123456_abc123',  ‚Üê –¢–æ—Ç –∂–µ ID!
  results: [...],
  timestamp: 1731678123789
}
```

---

## üé® –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

### 1. Connection Status

```
üü¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ
üî¥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...
```

### 2. Loading Spinner

–í—Ä–∞—â–∞—é—â–∏–π—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≤–æ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞.

### 3. Cache Hit Badge

```
‚ö° –ò–∑ –∫—ç—à–∞
```

–ü–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ 1.5 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ –∫—ç—à–∞.

### 4. Cache Statistics

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞         ‚îÇ
‚îÇ [–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à]          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ü–æ–ø–∞–¥–∞–Ω–∏—è:  15          ‚îÇ
‚îÇ –ü—Ä–æ–º–∞—Ö–∏:    8           ‚îÇ
‚îÇ Hit Rate:   65.22%      ‚îÇ
‚îÇ –ó–∞–ø–∏—Å–µ–π:    23          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ß–µ—Ä–µ–∑ .env

```env
# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
VITE_USE_DUAL_MODE=false

# WebSocket URLs
VITE_WS_URL=ws://localhost:8080
VITE_WS_REQUEST_URL=ws://localhost:8080
VITE_WS_RESPONSE_URL=ws://localhost:8081

# Performance
VITE_SEARCH_DEBOUNCE=300
VITE_SEARCH_THROTTLE=100

# Cache
VITE_CACHE_ENABLED=true
VITE_CACHE_TTL=300000
VITE_CACHE_SIZE=100

# Throttle
VITE_THROTTLE_ENABLED=true
```

### –ß–µ—Ä–µ–∑ props

```tsx
<MapSearch
  wsUrl="ws://localhost:8080"
  debounceMs={300}
  throttleMs={100}
  enableCache={true}
  enableThrottle={true}
  showStats={true}
  onSelectResult={handleSelect}
/>
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### Cache Stats API

```typescript
const stats = getCacheStats();
// {
//   hits: 15,
//   misses: 8,
//   hitRate: '65.22%',
//   cacheInfo: {
//     size: 23,
//     validEntries: 23,
//     expiredEntries: 0,
//     totalHits: 45,
//     hitRate: 1.96
//   }
// }
```

### Console Logs

```
[Cache] –ù–∞–π–¥–µ–Ω–æ –≤ –∫—ç—à–µ: "–ø–∞—Ä–∫"
WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω
[Request WS] –ü–æ–ª—É—á–µ–Ω–æ –æ—Ç client_123: search
[Response WS] –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ client_123: 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```

### Browser DevTools

1. **Network tab** - –≤—Ä–µ–º—è WebSocket –∑–∞–ø—Ä–æ—Å–æ–≤
2. **Console** - –ª–æ–≥–∏ –∫—ç—à–∞ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤
3. **Performance** - –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞

---

## üöÄ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
```
–ó–∞–ø—Ä–æ—Å "–ø–∞—Ä–∫":  120ms
–ó–∞–ø—Ä–æ—Å "–º—É–∑–µ–π": 118ms
–ü–æ–≤—Ç–æ—Ä "–ø–∞—Ä–∫":  121ms
```

### –° –í–°–ï–ú–ò –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
```
–ó–∞–ø—Ä–æ—Å "–ø–∞—Ä–∫":  95ms   ‚úÖ Debounce + Throttle
–ó–∞–ø—Ä–æ—Å "–º—É–∑–µ–π": 88ms   ‚úÖ Debounce + Throttle
–ü–æ–≤—Ç–æ—Ä "–ø–∞—Ä–∫":  2ms    ‚úÖ –ö—ç—à! (—É–ª—É—á—à–µ–Ω–∏–µ 98%)
```

**–ò—Ç–æ–≥–æ: —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ 98% –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤!** üî•
